<script type="text/javascript">
  async function loginWithProvider() {
    const authData = await pb.collection('users').authWithOAuth2({provider: '{{.Name}}'});
    const meta = authData.meta;

    if (meta.isNew) {
      const formData = new FormData();

      const response = await fetch(meta.avatarUrl);

      if (response.ok) {
        const file = await response.blob();
        formData.append('avatar', file);
      }

      formData.append('name', meta.name);

      await pb.collection('users').update(authData.record.id, formData);
    }
    pb.authStore.clear()
    location.reload()
  }
</script>
<button class="btn grid grid-cols-4" hx-on:click="loginWithProvider()">
  <img class="" src="{{.LogoRoute}}">
  <span class="col-span-3">
    Log in with {{.DisplayName}}
  </span>
</button>
