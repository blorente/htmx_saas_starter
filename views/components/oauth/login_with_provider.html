<script type="text/javascript">
  async function loginWithProvider() {
    pb.authStore.clear()
    const authData = await pb.collection('users').authWithOAuth2({provider: '{{.provider}}'});
    const meta = authData.meta;

    if (meta.isNew) {
      const formData = new FormData();

      const response = await fetch(meta.avatarUrl);

      if (response.ok) {
        const file = await response.blob();
        formData.append('avatar', file);
      }

      formData.append('name', meta.name);

      await pb.collection('users').update(authData.record.id, formData);
    }
  }
</script>
<button class="btn" hx-on:click="loginWithProvider()">Log in with {{.provider}}</button>
